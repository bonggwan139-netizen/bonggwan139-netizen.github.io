<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DBC | 지도</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body { margin:0 }
    #map { height: 100vh; }
    /* 방위표기(우측 상단) 간단 컴퍼스 스타일 */
    .leaflet-control.compass.leaflet-bar {
      background:#fff; border:1px solid #ccc; border-radius:4px;
      padding:6px 8px; box-shadow:0 1px 3px rgba(0,0,0,.15); font:12px/1.2 system-ui;
    }
    .compass .rose {
      position:relative; width:60px; height:60px; border:1px solid #aaa; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
    }
    .compass .needle { position:absolute; width:2px; height:44px; background:#d00; top:8px; left:50%;
      transform:translateX(-50%); border-radius:1px; }
    .compass .n,.compass .e,.compass .s,.compass .w { position:absolute; font-weight:700; color:#333; }
    .compass .n{ top:2px; left:50%; transform:translateX(-50%); }
    .compass .s{ bottom:2px; left:50%; transform:translateX(-50%); }
    .compass .e{ right:2px; top:50%; transform:translateY(-50%); }
    .compass .w{ left:2px; top:50%; transform:translateY(-50%); }
  </style>
</head>
<body>
  <header style="border-bottom:1px solid #eee; position:sticky; top:0; background:#fff; z-index:1000;">
    <nav style="max-width:1000px; margin:0 auto; padding:14px 20px; display:flex; gap:16px; align-items:center;">
      <strong style="font-size:18px;">DBC</strong>
      <a href="index.html">홈</a>
      <a href="about.html">소개</a>
      <a href="map.html"><b>지도</b></a>
    </nav>
  </header>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const KEY = "3C11E290-3F00-3957-8B03-FB4CB582692F"; // ← 발급받은 VWorld 키로 교체

    // 지도 생성 (제주특별자치도청 중심)
    const map = L.map('map', { zoomControl: true }).setView([33.4890, 126.4983], 13);

    // ----- 베이스 타일 정의 -----
    const street = L.tileLayer(
      `https://api.vworld.kr/req/wmts/1.0.0/${KEY}/Base/{z}/{y}/{x}.png`,
      { maxZoom: 19, attribution: '&copy; VWorld' }
    );

    const satellite = L.tileLayer(
      `https://api.vworld.kr/req/wmts/1.0.0/${KEY}/Satellite/{z}/{y}/{x}.jpeg`,
      { maxZoom: 19, attribution: '&copy; VWorld' }
    );

    // 기본은 '일반(street)'로 표시
    street.addTo(map);

    // ----- 레이어 선택(좌측 상단) -----
    const baseMaps = {
      '일반': street,
      '위성': satellite
    };
    L.control.layers(baseMaps, {}, { position: 'topleft', collapsed: false }).addTo(map);

    // ----- 방위 표기(우측 상단) -----
    const CompassControl = L.Control.extend({
      options: { position: 'topright' },
      onAdd: function () {
        const container = L.DomUtil.create('div', 'leaflet-control compass leaflet-bar');
        container.innerHTML = `
          <div class="arrow-wrap">
            <!-- 30x30 SVG, 위를 향하는 화살표. fill을 rgb(COMPASS_RGB)로 -->
            <svg width="30" height="30" viewBox="0 0 30 30" aria-label="north">
              <!-- 외곽선이 필요한 경우 stroke 추가 가능 -->
              <polygon points="15,2 26,26 15,21 4,26" fill="rgb(${COMPASS_RGB})"></polygon>
            </svg>
          </div>
          <div class="label">N</div>
        `;
        L.DomEvent.disableClickPropagation(container);
        L.DomEvent.disableScrollPropagation(container);
        return container;
      }
    });
    map.addControl(new CompassControl());

    // ----- 축척(우측 하단, 미터 단위) -----
    L.control.scale({ position: 'bottomright', metric: true, imperial: false }).addTo(map);

    // 테스트 마커: 제주특별자치도청
    L.marker([33.4890, 126.4983]).addTo(map).bindPopup("제주특별자치도청").openPopup();
  </script>
</body>
</html>
